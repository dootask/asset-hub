# 资产管理插件开发准备

## 项目说明

- 项目说明：此项目作为 DooTask 应用插件，用于资产管理。
- 项目名称：资产管理
- 项目标识：asset-hub

## 目录结构

```
├── .github/workflows/release.yml # 发布流程文件
├── dootask-plugin/ # 插件代码目录
├── web/ # Web 应用目录（Next.js，一体化前后端）
├── Dockerfile # 容器化部署文件
├── Makefile # 项目构建文件（一键运行开发环境等）
└── README.md # 项目说明文件
```

### .github/workflows/release.yml 文件说明

release.yml 文件示例：`/home/coder/workspaces/mcp/.github/workflows/release.yml`。

### dootask-plugin 目录说明

- 此目录用于存放插件代码，插件代码需要遵循 DooTask 插件开发规范，具体规范请参考 DooTask 插件开发文档：`/home/coder/workspaces/appstore/appstore/apps/_/README.md`。
- 示例：`/home/coder/workspaces/mcp/dootask-plugin/`。

### web 目录说明

- 此目录用于存放 Web 应用代码，采用 **Next.js 一体化方案**，在同一个项目中同时实现前端页面和后端 HTTP API。
- 技术栈：`Next.js`（App Router） + `React` + `Tailwind CSS` + `shadcn/ui`，使用 `pnpm` 作为包管理器。
- 初始化可以参考 Next.js 官方文档和 shadcn/ui 文档，使用类似命令：
  - `pnpm dlx shadcn@latest init`（初始化 Next.js + Tailwind + shadcn/ui，参考文档：`https://ui.shadcn.com/docs/installation/next.md`）
  - `pnpm dlx shadcn@latest add button`（按需添加组件）
- 后端接口通过 Next.js 的 Route Handlers（如 `app/api/**/route.ts`）实现，对外暴露 DooTask 插件所需的 HTTP API。
- 跟主程序的集成使用 `@dootask/tools` 工具包，开发文档：`/home/coder/workspaces/tools/README.md`。
- 访问路径：作为 DooTask 插件部署时，Web 应用对外需挂载在 `/apps/asset-hub` 路径下（页面路由与 API 前缀均以此为根）；开发调试阶段也应保持使用 `/apps/asset-hub` 作为访问前缀，以保证与正式环境一致。
- 示例：没有什么好说的，就是正常的 web 项目（但前后端统一在 Next.js 内实现）。

#### 技术架构方案

- **整体架构**：采用单一 Next.js 应用（位于 `web/` 目录）承担前端页面渲染和后端 HTTP API 服务，统一使用 TypeScript。
- **插件接口**：所有对 DooTask 暴露的插件接口（如配置、菜单、单点登录等）通过 Next.js 的 Route Handlers（`app/api/**/route.ts`）实现，运行时使用 Node.js。
- **数据存储**：使用 `sqlite3` 作为本地嵌入式数据库，在 Next.js 的服务器端代码中直接访问。
- **业务分层**：资产管理、系统管理、图谱能力等业务逻辑封装为可复用的 service / module，由 Route Handlers 与 React Server Components 共同调用。
- **部署方式**：通过 Docker 运行 Next.js 应用（如使用 `next start` 或自定义启动脚本），监听 DooTask 约定的端口，并通过插件配置或反向代理挂载在 `/apps/asset-hub` 路径下，对外提供统一的 HTTP 服务。

### Dockerfile 文件示例

Dockerfile 文件示例：`/home/coder/workspaces/mcp/Dockerfile`。

## 支持图谱功能

本项目支持图谱功能，通过 `graphiti-mcp` 工具包实现，group_id 为 `dootask-plugin-asset-hub`。

## 主题皮肤/多语言说明

- 本项目支持深色和浅色两种主题皮肤，通过 url 参数 `theme` 获取当前主题皮肤，如果包含 `dark` 则表示深色，否则表示浅色，项目不支持单独设置主题。
- 本项目支持多中/英文两种语言，通过 url 参数 `lang` 获取当前语言，如果包含 `zh` 则表示中文（比如：`zh-CN`、`ZH-TW`），否则表示英文，项目不支持单独设置语言。

----

## 功能需求规划

### 1. 首页

首页主要是概览和快捷入口，需要提供以下功能：

- 资产总览仪表板：实时展示资产总额、使用中、闲置、报废、待采购等指标。
- 资产分布统计：按资产类型或部门统计资产数量或价值，支持图表化展示。
- 快捷处理栏：提供审批中心、代办事项、帮助中心（用于查看更新通知等）入口。

### 2. 系统管理

系统管理为基础配置和后台管理的核心模块，包含：

- 公司管理：适用于集团公司或连锁门店等多公司场景，可添加/编辑/删除公司信息。
- 人员管理：同步组织架构，支持人员信息的增删改；可能需要与企业通讯录接口对接。
- 角色管理：

  - 系统角色：内置超级管理员、资产类型管理员（如固定资产管理员、设备管理员、无形资产管理员等）。
  - 审批中心配置：可自定义不同资产类型的审批流程，支持多级审批。
- 数据管理：

  - 报表统计：按操作人、操作类型（如入库/领用/借用等）、操作内容（新增/删除等）、操作时间等维度生成报表，并可查看详情。
  - 自定义报表：预留扩展板块，可根据需要自定义报表字段和格式。
- 其他管理：

  - 操作管理：对各种操作进行管理，例如入库、出库、新增、删除、编辑、导入、导出等。
  - 升级管理：提供系统版本和用户数量的升级方案，绑定不同价位（价格/人数/年），包括版本有效期和续费操作。

### 3. 资产管理

资产管理是系统的核心功能，包含资产的全生命周期管理：

- 资产设置：设定资产属性字段、状态值等基础配置。
- 资产列表：列出所有资产，支持筛选、分页和排序。
- 资产新增与批量导入：支持单条新增和批量导入，同时提供编辑、删除、筛选、批量导出功能。
- 分类管理：支持自定义资产类型（如公司固定资产、项目设备、无形资产）。
- 资产操作流程：

  - 采购：资产购置流程，包含提交申请、审核、通过三个环节，支持审批意见。
  - 入库：资产入库时可拍摄至少三张不同角度照片（可选），流程同样是提交→审核→通过。
  - 领用：员工领取资产的流程，提交申请后审批通过即可领取。
  - 借用/归还：允许借出并归还资产，借用逾期时需提醒（如对接待办系统 DooTask），流程为提交→审核→通过。
  - 派发：用于资产分发，记录发货数量、日期、经办人、物流信息和费用等，流程同样为提交→审核→通过。
  - 其他操作：包括维修、报废处理、回收、遗失等，流程为提交→审核→通过。
- 资产盘点：支持创建盘点任务，设置盘点名称、选择资产类型、盘点时间及负责人，并提供数据下载。

### 4. 耗材管理（后期扩展）

针对易耗品的管理，可在后期上线：

- 耗材设置：类似资产设置，配置耗材类别和属性。
- 耗材操作流程：参照资产操作流程，包含采购、入库、领用/出库、处理等，流程需走审批。
- 出库管理：一般在月底进行盘点后出库，便于库存核对。
- 耗材处理：针对过期、损坏、遗失的耗材进行处理。
- 耗材盘点：后期扩展功能，用于盘点耗材库存。

### 5. 突出展示

在系统主界面或个人中心突出显示当前版本号。
